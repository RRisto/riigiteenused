{
    "contents" : "#abifunktsioon kõikide kanalite pikaks tegemiseks\n\n#' @export\nkorrastaja=function(andmed, eemalda, mootmiseAasta) {\n  library(reshape2)\n  #eemalda - mis osa columnite nimedest tuleb eemdalda\n  names(andmed)=gsub(pattern=eemalda,\"\" ,names(andmed))\n  #kanalite lõikes meldime\n  veeb=meltimine(\"Veebileht / portaal.\", data=andmed)\n  iseteen=meltimine(\"E-iseteenindus.\", data=andmed)\n  eesti=meltimine(\"Eesti.ee.\", data=andmed)\n  nuti=meltimine(\"Nutirakendus.\", data=andmed)\n  digitv=meltimine(\"Digitelevisioon.\", data=andmed)\n  epost=meltimine(\"E-post.\", data=andmed)\n  sms=meltimine(\"Tekstis\", data=andmed) #shiny jaoks vaja\n  #sms=meltimine(\"Tekstisõnum.\", data=andmed) #shiny jaoks vaja\n  #sms=meltimine(enc2utf8(\"Tekstisõnum.\"), data=andmed)\n  telefon=meltimine(\"Telefon.\", data=andmed)\n  faks=meltimine(\"Faks.\", data=andmed)\n  post=meltimine(\"Post.\", data=andmed)\n  lett=meltimine(\"Letiteenus b\", data=andmed) #shiny jaoks vaja\n  #lett=meltimine(\"Letiteenus büroos.\", data=andmed) #shiny jaoks vaja\n  #lett=meltimine(enc2utf8(\"Letiteenus büroos.\"), data=andmed)\n  kodus=meltimine(\"Kliendi juures.\", data=andmed)\n  #rbindime\n  koos=rbind(veeb, iseteen, eesti, nuti, digitv, epost, sms, telefon, faks,\n             post, lett, kodus)\n  #leiame kanali ja näitaja\n  #stati saamiseks eemaldame punktid kanali nimedest\n  koos$variable=gsub(\".ee.\", \".\", as.character(koos$variable), fixed=T)\n  koos$variable=gsub(\"Letiteenus büroos\", \"Letiteenus\", as.character(koos$variable), fixed=T)\n  #koos$variable=gsub(enc2utf8(\"Letiteenus büroos\"), \"Letiteenus\", as.character(koos$variable), fixed=T)\n  koos$variable=gsub(\"E-iseteenindus\", \"Eiseteenindus\", as.character(koos$variable), fixed=T)\n  koos$variable=gsub(\"E-post\", \"Epost\", as.character(koos$variable), fixed=T)\n  koos$variable=gsub(\"Veebileht / portaal\", \"Veebileht\", as.character(koos$variable), fixed=T)\n  stat=gsub(\"Kliendi juures\", \"Kliendijuures\", as.character(koos$variable), fixed=T)\n\n  #lõikame punktini asja maha\n  stat <- strsplit(stat, split =\"\\\\.\")\n  #teeme df-ks\n  df=as.data.frame(stat)\n  #transponeerime\n  df=as.data.frame(t(df))\n  #lisame algsesse andmestikku\n  koos$kanal=df[,2]\n  koos$naitaja=df[,3]\n  #teeme numbriliseks\n  koos$value=as.numeric(as.character(koos$value))\n  koos$MootmiseAasta=mootmiseAasta\n  koos\n}\n\n#sama, mis eelmine funktsioon, kuid kasutab data.table'i fomraati\n#' @export\nkorrastajaDT=function(andmed, eemalda, mootmiseAasta) {\n  library(data.table)\n  #eemalda - mis osa columnite nimedest tuleb eemdalda\n  setnames(andmed, names(andmed), gsub(eemalda, \"\", names(andmed)))\n  #kanalite lõikes meldime\n  veeb=meltimineDT(\"Veebileht / portaal.\", data=andmed)\n  iseteen=meltimineDT(\"E-iseteenindus.\", data=andmed)\n  eesti=meltimineDT(\"Eesti.ee.\", data=andmed)\n  nuti=meltimineDT(\"Nutirakendus.\", data=andmed)\n  digitv=meltimineDT(\"Digitelevisioon.\", data=andmed)\n  epost=meltimineDT(\"E-post.\", data=andmed)\n  sms=meltimineDT(\"Tekstisõnum.\", data=andmed)\n  telefon=meltimineDT(\"Telefon.\", data=andmed)\n  faks=meltimineDT(\"Faks.\", data=andmed)\n  post=meltimineDT(\"Post.\", data=andmed)\n  lett=meltimineDT(\"Letiteenus.\", data=andmed)\n  kodus=meltimineDT(\"Kliendi juures.\", data=andmed)\n\n  #rbindime\n  koos=rbindlist(list(veeb, iseteen, eesti, nuti, digitv, epost, sms, telefon, faks,\n                      post, lett, kodus))\n\n  #eemaldame kanali ja näitaja ning paneme eraldi veergu\n  if (length(koos)==0) {\n    return(NULL)\n  } else {\n    koos[,variable:=gsub(\".ee.\", \".\", as.character(koos[,variable]), fixed=T)]\n    koos[,variable:=gsub(\"Letiteenus büroos\", \"Letiteenus\", as.character(koos[,variable]), fixed=T)]\n    koos[,variable:=gsub(\"E-iseteenindus\", \"Eiseteenindus\", as.character(koos[,variable]), fixed=T)]\n    koos[,variable:=gsub(\"E-post\", \"Epost\", as.character(koos[,variable]), fixed=T)]\n    koos[,variable:=gsub(\"Veebileht / portaal\", \"Veebileht\", as.character(koos[,variable]), fixed=T)]\n    koos[,variable:=gsub(\"Kliendi juures\", \"Kliendijuures\", as.character(koos[,variable]), fixed=T)]\n\n    koos[, c(\"kanal\", \"naitaja\") := tstrsplit(as.character(koos[[\"variable\"]]), \"\\\\.(?=[^\\\\.]+$)\", perl=T)]\n    koos[,kanal:=gsub(\"^.*\\\\.\", \"\", koos[, kanal])]\n    #viskame välja tühjad read, kus pole linki\n    koos=koos[link!=\"NA\"]\n    koos[,MootmiseAasta:=mootmiseAasta]\n    koos\n  }\n}\n",
    "created" : 1460309823436.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2477019396",
    "id" : "73336E45",
    "lastKnownWriteTime" : 1460310942,
    "path" : "~/R/riigiteenused/R/korrastaja.R",
    "project_path" : "R/korrastaja.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}